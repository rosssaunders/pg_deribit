/*
* AUTO-GENERATED FILE - DO NOT MODIFY
*
* This SQL file was generated by a code generation tool. Any modifications
* made to this file may be overwritten by subsequent code generation
* processes and could lead to inconsistencies or errors in the application.
*
* For any required changes, please modify the source templates or the
* code generation tool's configurations and regenerate this file.
*
* WARNING: MODIFYING THIS FILE DIRECTLY CAN LEAD TO UNEXPECTED BEHAVIOR
* AND IS STRONGLY DISCOURAGED.
*/
create type deribit.private_get_broker_trade_requests_response_trade as (
    "amount" double precision,
    "direction" text,
    "instrument_name" text,
    "price" double precision
);

comment on column deribit.private_get_broker_trade_requests_response_trade."amount" is 'Trade amount.';
comment on column deribit.private_get_broker_trade_requests_response_trade."direction" is 'Trade direction (buy or sell).';
comment on column deribit.private_get_broker_trade_requests_response_trade."instrument_name" is 'Name of the traded instrument.';
comment on column deribit.private_get_broker_trade_requests_response_trade."price" is 'Trade price.';

create type deribit.private_get_broker_trade_requests_response_taker as (
    "client_id" bigint,
    "client_link_id" bigint,
    "client_link_name" text,
    "client_name" text,
    "state" text,
    "user_id" text
);

comment on column deribit.private_get_broker_trade_requests_response_taker."client_id" is 'ID of a client; available to broker. Represents a group of users under a common name.';
comment on column deribit.private_get_broker_trade_requests_response_taker."client_link_id" is 'ID assigned to a single user in a client; available to broker.';
comment on column deribit.private_get_broker_trade_requests_response_taker."client_link_name" is 'Name of the linked user within the client; available to broker.';
comment on column deribit.private_get_broker_trade_requests_response_taker."client_name" is 'Name of the client; available to broker.';
comment on column deribit.private_get_broker_trade_requests_response_taker."state" is 'State of the request from the taker side: initial, approved, or rejected.';
comment on column deribit.private_get_broker_trade_requests_response_taker."user_id" is 'Obscured user id of the taker.';

create type deribit.private_get_broker_trade_requests_response_maker as (
    "client_id" bigint,
    "client_link_id" bigint,
    "client_link_name" text,
    "client_name" text,
    "state" text,
    "user_id" text
);

comment on column deribit.private_get_broker_trade_requests_response_maker."client_id" is 'ID of a client; available to broker. Represents a group of users under a common name.';
comment on column deribit.private_get_broker_trade_requests_response_maker."client_link_id" is 'ID assigned to a single user in a client; available to broker.';
comment on column deribit.private_get_broker_trade_requests_response_maker."client_link_name" is 'Name of the linked user within the client; available to broker.';
comment on column deribit.private_get_broker_trade_requests_response_maker."client_name" is 'Name of the client; available to broker.';
comment on column deribit.private_get_broker_trade_requests_response_maker."state" is 'State of the request from the maker side: initial, approved, or rejected.';
comment on column deribit.private_get_broker_trade_requests_response_maker."user_id" is 'Obscured user id of the maker.';

create type deribit.private_get_broker_trade_requests_response_result as (
    "maker" deribit.private_get_broker_trade_requests_response_maker,
    "nonce" text,
    "state" text,
    "taker" deribit.private_get_broker_trade_requests_response_taker,
    "timestamp" bigint,
    "trades" deribit.private_get_broker_trade_requests_response_trade[]
);

comment on column deribit.private_get_broker_trade_requests_response_result."nonce" is 'Nonce for approving or rejecting the broker block trade request.';
comment on column deribit.private_get_broker_trade_requests_response_result."state" is 'State of the broker block trade request.';
comment on column deribit.private_get_broker_trade_requests_response_result."timestamp" is 'Timestamp of the broker block trade request (milliseconds since the UNIX epoch).';

create type deribit.private_get_broker_trade_requests_response as (
    "id" bigint,
    "jsonrpc" text,
    "result" deribit.private_get_broker_trade_requests_response_result[]
);

comment on column deribit.private_get_broker_trade_requests_response."id" is 'The id that was sent in the request';
comment on column deribit.private_get_broker_trade_requests_response."jsonrpc" is 'The JSON-RPC version (2.0)';

create function deribit.private_get_broker_trade_requests()
returns setof deribit.private_get_broker_trade_requests_response_result
language sql
as $$
    with http_response as (
        select deribit.private_jsonrpc_request(
            auth := deribit.get_auth(),
            url := '/private/get_broker_trade_requests'::deribit.endpoint,
            request := null::text,
            rate_limiter := 'deribit.non_matching_engine_request_log_call'::name
        ) as http_response
    ),
    result as (
        select (jsonb_populate_record(
            null::deribit.private_get_broker_trade_requests_response,
            convert_from((http_response.http_response).body, 'utf-8')::jsonb)
        ).result
        from http_response
    )
    select
        (b)."maker"::deribit.private_get_broker_trade_requests_response_maker,
        (b)."nonce"::text,
        (b)."state"::text,
        (b)."taker"::deribit.private_get_broker_trade_requests_response_taker,
        (b)."timestamp"::bigint,
        (b)."trades"::deribit.private_get_broker_trade_requests_response_trade[]
    from (
        select (unnest(r.data)) b
        from result r(data)
    ) a
    
$$;

comment on function deribit.private_get_broker_trade_requests is 'Broker Method Provides a list of broker block trade requests including pending approvals, declined trades, and expired trades. timestamp and nonce received in response can be used to approve or reject the pending broker block trade.';
