/*
* AUTO-GENERATED FILE - DO NOT MODIFY
*
* This SQL file was generated by a code generation tool. Any modifications
* made to this file may be overwritten by subsequent code generation
* processes and could lead to inconsistencies or errors in the application.
*
* For any required changes, please modify the source templates or the
* code generation tool's configurations and regenerate this file.
*
* WARNING: MODIFYING THIS FILE DIRECTLY CAN LEAD TO UNEXPECTED BEHAVIOR
* AND IS STRONGLY DISCOURAGED.
*/
create type deribit.private_get_account_summaries_request as (
    "subaccount_id" bigint,
    "extended" boolean
);

comment on column deribit.private_get_account_summaries_request."subaccount_id" is 'The user id for the subaccount';
comment on column deribit.private_get_account_summaries_request."extended" is 'Include additional fields';

create type deribit.private_get_account_summaries_response_options_theta_map as (
    "total_delta_total_usd" double precision,
    "available_withdrawal_funds" double precision,
    "equity" double precision,
    "options_gamma" double precision
);

comment on column deribit.private_get_account_summaries_response_options_theta_map."total_delta_total_usd" is 'Optional (only for users using cross margin). The account''s total delta total in all cross collateral currencies, expressed in USD';
comment on column deribit.private_get_account_summaries_response_options_theta_map."available_withdrawal_funds" is 'The account''s available to withdrawal funds';
comment on column deribit.private_get_account_summaries_response_options_theta_map."equity" is 'The account''s current equity';
comment on column deribit.private_get_account_summaries_response_options_theta_map."options_gamma" is 'Options summary gamma';

create type deribit.private_get_account_summaries_response_options_vega_map as (
    "balance" double precision,
    "total_equity_usd" double precision,
    "additional_reserve" double precision,
    "projected_initial_margin" double precision,
    "available_funds" double precision,
    "spot_reserve" double precision,
    "projected_delta_total" double precision,
    "portfolio_margining_enabled" boolean,
    "total_maintenance_margin_usd" double precision,
    "total_margin_balance_usd" double precision,
    "total_pl" double precision,
    "margin_balance" double precision,
    "options_theta_map" deribit.private_get_account_summaries_response_options_theta_map,
    "system_name" text,
    "type" text,
    "username" text
);

comment on column deribit.private_get_account_summaries_response_options_vega_map."balance" is 'The account''s balance';
comment on column deribit.private_get_account_summaries_response_options_vega_map."total_equity_usd" is 'Optional (only for users using cross margin). The account''s total equity in all cross collateral currencies, expressed in USD';
comment on column deribit.private_get_account_summaries_response_options_vega_map."additional_reserve" is 'The account''s balance reserved in other orders';
comment on column deribit.private_get_account_summaries_response_options_vega_map."projected_initial_margin" is 'Projected initial margin';
comment on column deribit.private_get_account_summaries_response_options_vega_map."available_funds" is 'The account''s available funds';
comment on column deribit.private_get_account_summaries_response_options_vega_map."spot_reserve" is 'The account''s balance reserved in active spot orders';
comment on column deribit.private_get_account_summaries_response_options_vega_map."projected_delta_total" is 'The sum of position deltas without positions that will expire during closest expiration';
comment on column deribit.private_get_account_summaries_response_options_vega_map."portfolio_margining_enabled" is 'true when portfolio margining is enabled for user';
comment on column deribit.private_get_account_summaries_response_options_vega_map."total_maintenance_margin_usd" is 'Optional (only for users using cross margin). The account''s total maintenance margin in all cross collateral currencies, expressed in USD';
comment on column deribit.private_get_account_summaries_response_options_vega_map."total_margin_balance_usd" is 'Optional (only for users using cross margin). The account''s total margin balance in all cross collateral currencies, expressed in USD';
comment on column deribit.private_get_account_summaries_response_options_vega_map."total_pl" is 'Profit and loss';
comment on column deribit.private_get_account_summaries_response_options_vega_map."margin_balance" is 'The account''s margin balance';
comment on column deribit.private_get_account_summaries_response_options_vega_map."options_theta_map" is 'Map of options'' thetas per index';
comment on column deribit.private_get_account_summaries_response_options_vega_map."system_name" is 'System generated user nickname (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_options_vega_map."type" is 'Account type (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_options_vega_map."username" is 'Account name (given by user) (available when parameter extended = true)';

create type deribit.private_get_account_summaries_response_options_gamma_map as (
    "futures_pl" double precision,
    "currency" text,
    "options_value" double precision,
    "projected_maintenance_margin" double precision,
    "options_vega" double precision,
    "session_rpl" double precision,
    "has_non_block_chain_equity" boolean,
    "deposit_address" text,
    "total_initial_margin_usd" double precision,
    "futures_session_upl" double precision,
    "options_session_upl" double precision,
    "cross_collateral_enabled" boolean,
    "options_theta" double precision,
    "margin_model" text,
    "options_delta" double precision,
    "options_pl" double precision,
    "options_vega_map" deribit.private_get_account_summaries_response_options_vega_map
);

comment on column deribit.private_get_account_summaries_response_options_gamma_map."futures_pl" is 'Futures profit and Loss';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."currency" is 'Currency of the summary';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."options_value" is 'Options value';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."projected_maintenance_margin" is 'Projected maintenance margin';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."options_vega" is 'Options summary vega';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."session_rpl" is 'Session realized profit and loss';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."has_non_block_chain_equity" is 'Optional field returned with value true when user has non block chain equity that is excluded from proof of reserve calculations';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."deposit_address" is 'The deposit address for the account (if available)';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."total_initial_margin_usd" is 'Optional (only for users using cross margin). The account''s total initial margin in all cross collateral currencies, expressed in USD';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."futures_session_upl" is 'Futures session unrealized profit and Loss';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."options_session_upl" is 'Options session unrealized profit and Loss';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."cross_collateral_enabled" is 'When true cross collateral is enabled for user';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."options_theta" is 'Options summary theta';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."margin_model" is 'Name of user''s currently enabled margin model';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."options_delta" is 'Options summary delta';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."options_pl" is 'Options profit and Loss';
comment on column deribit.private_get_account_summaries_response_options_gamma_map."options_vega_map" is 'Map of options'' vegas per index';

create type deribit.private_get_account_summaries_response_limits as (
    "initial_margin" double precision,
    "options_gamma_map" deribit.private_get_account_summaries_response_options_gamma_map
);

comment on column deribit.private_get_account_summaries_response_limits."initial_margin" is 'The account''s initial margin';
comment on column deribit.private_get_account_summaries_response_limits."options_gamma_map" is 'Map of options'' gammas per index';

create type deribit.private_get_account_summaries_response_fee as (
    "currency" text,
    "fee_type" text,
    "instrument_type" text,
    "maker_fee" double precision,
    "taker_fee" double precision
);

comment on column deribit.private_get_account_summaries_response_fee."currency" is 'The currency the fee applies to';
comment on column deribit.private_get_account_summaries_response_fee."fee_type" is 'Fee type - relative if fee is calculated as a fraction of base instrument fee, fixed if fee is calculated solely using user fee';
comment on column deribit.private_get_account_summaries_response_fee."instrument_type" is 'Type of the instruments the fee applies to - future for future instruments (excluding perpetual), perpetual for future perpetual instruments, option for options';
comment on column deribit.private_get_account_summaries_response_fee."maker_fee" is 'User fee as a maker';
comment on column deribit.private_get_account_summaries_response_fee."taker_fee" is 'User fee as a taker';

create type deribit.private_get_account_summaries_response_summary as (
    "maintenance_margin" double precision,
    "delta_total" double precision,
    "options_session_rpl" double precision,
    "futures_session_rpl" double precision,
    "session_upl" double precision,
    "fee_balance" double precision,
    "fees" deribit.private_get_account_summaries_response_fee[],
    "limits" deribit.private_get_account_summaries_response_limits
);

comment on column deribit.private_get_account_summaries_response_summary."maintenance_margin" is 'The maintenance margin.';
comment on column deribit.private_get_account_summaries_response_summary."delta_total" is 'The sum of position deltas';
comment on column deribit.private_get_account_summaries_response_summary."options_session_rpl" is 'Options session realized profit and Loss';
comment on column deribit.private_get_account_summaries_response_summary."futures_session_rpl" is 'Futures session realized profit and Loss';
comment on column deribit.private_get_account_summaries_response_summary."session_upl" is 'Session unrealized profit and loss';
comment on column deribit.private_get_account_summaries_response_summary."fee_balance" is 'The account''s fee balance (it can be used to pay for fees)';
comment on column deribit.private_get_account_summaries_response_summary."fees" is 'User fees in case of any discounts (available when parameter extended = true and user has any discounts)';
comment on column deribit.private_get_account_summaries_response_summary."limits" is 'Returned object is described in separate document.';

create type deribit.private_get_account_summaries_response_result as (
    "creation_timestamp" bigint,
    "email" text,
    "id" bigint,
    "interuser_transfers_enabled" boolean,
    "login_enabled" boolean,
    "mmp_enabled" boolean,
    "referrer_id" text,
    "security_keys_enabled" boolean,
    "self_trading_extended_to_subaccounts" text,
    "self_trading_reject_mode" text,
    "summaries" deribit.private_get_account_summaries_response_summary[]
);

comment on column deribit.private_get_account_summaries_response_result."creation_timestamp" is 'Time at which the account was created (milliseconds since the Unix epoch; available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."email" is 'User email (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."id" is 'Account id (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."interuser_transfers_enabled" is 'true when the inter-user transfers are enabled for user (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."login_enabled" is 'Whether account is loginable using email and password (available when parameter extended = true and account is a subaccount)';
comment on column deribit.private_get_account_summaries_response_result."mmp_enabled" is 'Whether MMP is enabled (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."referrer_id" is 'Optional identifier of the referrer (of the affiliation program, and available when parameter extended = true), which link was used by this account at registration. It coincides with suffix of the affiliation link path after /reg-';
comment on column deribit.private_get_account_summaries_response_result."security_keys_enabled" is 'Whether Security Key authentication is enabled (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."self_trading_extended_to_subaccounts" is 'true if self trading rejection behavior is applied to trades between subaccounts (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."self_trading_reject_mode" is 'Self trading rejection behavior - reject_taker or cancel_maker (available when parameter extended = true)';
comment on column deribit.private_get_account_summaries_response_result."summaries" is 'Aggregated list of per-currency account summaries';

create type deribit.private_get_account_summaries_response as (
    "id" bigint,
    "jsonrpc" text,
    "result" deribit.private_get_account_summaries_response_result
);

comment on column deribit.private_get_account_summaries_response."id" is 'The id that was sent in the request';
comment on column deribit.private_get_account_summaries_response."jsonrpc" is 'The JSON-RPC version (2.0)';

create function deribit.private_get_account_summaries(
    auth deribit.auth
,    "subaccount_id" bigint default null,
    "extended" boolean default null
)
returns deribit.private_get_account_summaries_response_result
language sql
as $$
    
    with request as (
        select row(
            "subaccount_id",
            "extended"
        )::deribit.private_get_account_summaries_request as payload
    ), 
    http_response as (
        select deribit.private_jsonrpc_request(
            auth := auth,             
            url := '/private/get_account_summaries'::deribit.endpoint, 
            request := request.payload, 
            rate_limiter := 'deribit.non_matching_engine_request_log_call'::name
        ) as http_response
        from request
    )
    select (jsonb_populate_record(
        null::deribit.private_get_account_summaries_response, 
        convert_from((a.http_response).body, 'utf-8')::jsonb)).result
    from http_response a

$$;

comment on function deribit.private_get_account_summaries is 'Retrieves a per-currency list of user account summaries. To read subaccount summary use subaccount_id parameter.';
